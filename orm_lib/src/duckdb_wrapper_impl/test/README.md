# DuckDB 测试套件

本目录包含了DuckDB数据库的全面测试套件，用于验证DuckDB在Drogon框架中的集成和功能。

## 测试文件说明

### 1. test_main.cc - 综合功能测试
这是主要的测试文件，包含以下测试模块：

#### 基本功能测试
- 表的创建、删除
- 数据的插入、查询、更新、删除
- 参数化查询
- 事务处理

#### JSON功能测试
- JSON数据类型的创建和操作
- JSON路径查询
- 复杂JSON结构的处理
- SqlBinder与JSON的结合使用

#### 数据类型测试
- 所有支持的数据类型（INTEGER, BIGINT, DOUBLE, VARCHAR, BOOLEAN, DATE, TIME, TIMESTAMP, BLOB等）
- 类型转换和验证
- NULL值处理

#### 错误处理测试
- SQL语法错误处理
- 约束违反处理（主键、唯一键等）
- 异常捕获和报告

#### 并发测试
- 多线程并发插入
- 多线程并发查询
- 线程安全性验证

#### 性能测试
- 批量插入性能
- 查询性能测试
- 性能基准验证

#### 高级功能测试
- 视图创建和查询
- 复杂JSON查询
- 聚合函数测试

#### 协程模式测试（如果支持）
- 协程版本的异步操作
- 协程与数据库操作的集成

### 2. duckdb_specific_test.cc - DuckDB特有功能测试
专门测试DuckDB的独特功能：

#### 向量化操作测试
- 大规模数据的向量化处理
- 向量化聚合操作
- 窗口函数测试

#### 分析函数测试
- 时间序列数据处理
- 移动平均计算
- 排名函数测试

#### 复杂JSON操作测试
- 嵌套JSON结构处理
- JSON路径查询
- JSON聚合操作

#### 数据类型和函数测试
- 高级数据类型支持
- 类型转换函数
- 数学和字符串函数

#### 性能优化测试
- 大规模数据插入性能
- 索引效果测试
- 查询优化验证

## 编译和运行

### 编译
```bash
mkdir build && cd build
cmake ..
make 
```

### 运行测试

#### 1. 运行综合功能测试
```bash
# 回调模式测试
./duckdb_test

# 协程模式测试（如果支持）
./duckdb_test --coro
```

#### 2. 运行DuckDB特有功能测试
```bash
./duckdb_specific_test
```

## 测试输出说明

测试运行时会显示详细的测试结果：

```
=== 基本功能测试 ===
✓ 创建表 - PASSED
✓ 插入数据 - PASSED
✓ 查询数据 - PASSED
...

=== 测试总结 ===
总测试数: 25
成功: 24
失败: 1
成功率: 96.0%
```

## 测试覆盖范围

### 功能覆盖
- ✅ 基本CRUD操作
- ✅ 事务处理
- ✅ 参数化查询
- ✅ JSON数据类型
- ✅ 复杂查询
- ✅ 错误处理
- ✅ 并发操作
- ✅ 性能测试
- ✅ 协程支持（如果可用）

### DuckDB特有功能
- ✅ 向量化操作
- ✅ 分析函数
- ✅ 窗口函数
- ✅ 复杂JSON操作
- ✅ 高级数据类型
- ✅ 性能优化

## 测试数据库文件

测试会在当前目录创建以下数据库文件：
- `comprehensive_test.db` - 综合测试数据库
- `duckdb_specific_test.db` - 特有功能测试数据库

## 注意事项

1. **依赖要求**：确保DuckDB库已正确安装和链接
2. **内存使用**：性能测试会创建大量数据，确保有足够的内存
3. **并发测试**：并发测试使用多线程，确保系统支持
4. **协程支持**：协程测试需要C++20支持

### 调试模式

启用详细日志：
```bash
export DROGON_LOG_LEVEL=DEBUG
./duckdb_test
```